extends ../layout

block dynamic-css
    link(rel='stylesheet', href="#{STATIC_URL}css/dynamic/viz/?visualizations[]=#{_.pluck(visualizations, 'type').join('&visualizations[]=')}")

    
block container

    .container.content.wrap.push.dashboard
        .row
            .six.columns
                h2(data-editable, data-model="dashboard", data-model-id="#{dashboard.id}", data-key="name")
                    | #{dashboard.getDisplayName()}
                .subheader
                    p
                        | Created #{moment(dashboard.createdAt).fromNow()}
                    p
                        small
                            a(href="/sessions/#{dashboard.id}/delete", data-confirm="Are you sure you want to delete this dashboard?")
                                | Delete Dashboard

                    p
                        small
                            a(href="#add-data-modal", rel="modal:open")
                                | Add Visualization
                    p
                        small
                            a(href="../public")
                                | Public Link



        .row.dashboard-container
            .columns

                .gridster
                    ul
                        for viz, i in visualizations
                            - layoutItem = dashboard.layout[i]
                            li.dashboard-layout-item(data-row='#{layoutItem.row}', data-col='#{layoutItem.col}', data-sizex='#{layoutItem.size_x}', data-sizey='#{layoutItem.size_y}')
                                .dashboard-item-container(data-model="visualization", data-model-id="#{viz.id}")
                                    .visualization.dashboard-item(data-type="#{viz.type}", data-dataset-id="#{viz.DataSetId}", data-images="#{JSON.stringify(viz.images)}", id="viz-#{viz.id}", data-initialized="false")



        .row.datasets
            for dataSet in dataSets
                .dataset(data-data="#{JSON.stringify(dataSet.data)}", data-model-id="#{dataSet.id}")



        .modal#add-data-modal
            form#add-visualization(method="post", action="./visualizations")
                h3
                    | Create Visualization

                if !dataSets.length
                    h4
                        | Please add a dataset first.

                else 
                    select(name="dataset")
                        each dataset in dataSets
                            option(value="#{dataset.id}")
                                | #{dataset.name}

                    select(name="type")
                        each type, typeName in vizTypes
                            if typeName === 'line'
                                option(value="#{typeName}", selected="selected")
                                    | #{typeName}
                            else
                                option(value="#{typeName}")
                                    | #{typeName}

                    input(type="submit", value="Submit")




block scripts
    script(src='//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js')
    script(src="/socket.io/socket.io.js")
    script(src='#{STATIC_URL}js/basic.js')
    script(src="#{STATIC_URL}js/dynamic/viz/?visualizations[]=#{_.pluck(visualizations, 'type').join('&visualizations[]=')}")
    //- script(src='#{STATIC_URL}js/gridster.js')
    script(src='#{STATIC_URL}js/dashboard.js')
